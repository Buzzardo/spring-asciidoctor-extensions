plugins {
	id 'com.github.johnrengelman.shadow' version '5.1.0'
}

apply plugin: 'io.spring.compatibility-test'
apply plugin: 'maven-publish'
apply from: "$rootDir/gradle/publish-maven.gradle"

dependencies {
	runtimeOnly project(":block-switch:block-switch-aj1x")
	runtimeOnly project(":block-switch:block-switch-aj2x")
	testImplementation "org.asciidoctor:asciidoctorj:$asciidoctorjVersion"
}

compatibilityTest {
	useJUnitPlatform()
	dependency('AsciidoctorJ') { asciidoctorj ->
		asciidoctorj.groupId = 'org.asciidoctor'
		asciidoctorj.artifactId = 'asciidoctorj'
		asciidoctorj.versions = [ asciidoctorj16Version, asciidoctorj20Version, asciidoctorj21Version, asciidoctorj22Version]
	}
}

shadowJar {
	mergeServiceFiles()
	classifier = ''
}

jar {
	enabled = false
}

assemble {
	dependsOn shadowJar
}

publishing {
	publications {
		shadow(MavenPublication) { publication ->
			project.shadow.component(publication)
		}
	}
}